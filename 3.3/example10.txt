// In this example we drive a vortex wall in Permalloy by spin-transfer torque.
// We set up a post-step function that makes the simulation box "follow" the domain
// wall. By removing surface charges at the left and right ends, we mimic an infintely
// long wire.

setgridsize(256, 32, 1)
setcellsize(3e-9, 3e-9, 10e-9)

Msat    = 860e3
Aex     = 13e-12
Xi      = 0.1
m       = twodomain(1,0,0,  0,1,0,  -1,0,0)

notch := rect(20e-9, 20e-9).RotZ(45*pi/180).transl(0, 16*3e-9, 0).inverse()
setGeom(notch.Repeat(200e-9, 32*3e-9, 0))


// Remove surface charges from left (mx=1) and right (mx=-1) sides to mimic infinitely long wire. We have to specify the region (0) at the boundaries.
ext_rmSurfaceCharge(0, 1, -1)


// Relax
Alpha = 3    // high damping for fast relax
RunWhile(MaxTorque > 1e-3)    // relax
Alpha = 0.02 // restore normal damping

// Set post-step function that centers simulation window on domain wall.
PostStep(ext_centerInplaneWall)

// Schedule output
autosave(m, 100e-12)
tableadd(ext_dwpos)   // domain wall position
tableadd(ext_dwspeed) // domain wall speed
tableautosave(10e-12)

// Run the simulation with current through the sample
pol = 0.56
J   = vector(-8e12, 0, 0)
Run(1e-9)