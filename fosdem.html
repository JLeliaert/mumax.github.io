<!DOCTYPE html>
<!-- saved from url=(0036)http://localhost:3999/fosdem.slide#1 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Scientific GPU computing with Go </title>
    <meta charset="utf-8">
    <script src="./fosdem_files/slides.js"></script><style type="text/css"></style>
  <meta name="viewport" content="width=1100,height=750"><meta name="apple-mobile-web-app-capable" content="yes"></head>

  <body style="display: none" class="loaded">

    <section class="slides layout-widescreen">
      
      <article class="current">
        <h1>Scientific GPU computing with Go </h1>
        <h3>A novel approach to highly reliable CUDA HPC</h3>
        <h3>1 February 2014</h3>
        
          <div class="presenter">
            
  
  <p>
    Arne Vansteenkiste
  </p>
  

  
  <p>
    Ghent University
  </p>
  

          </div>
        
          <div class="presenter">
            
  
  <p>
    
  </p>
  

          </div>
        
      </article>
      
  
  
      <article class="next">
      
        <h3>Real-world example (micromagnetism)</h3>
        
  
  <p>
    DyNaMat LAB @ UGent: Microscale Magnetic Modeling:
  </p>
  

  <ul>
  
    <li>Hard Disks</li>
  
    <li>Magnetic RAM</li>
  
    <li>Microwave components</li>
  
    <li>...</li>
  
  </ul>

<div class="image">
  <img src="./fosdem_files/vspace1.png">
</div>

<div class="image">
  <img src="./fosdem_files/banner.png">
</div>

      
      </article>
  
  
  
      <article class="far-next">
      
        <h3>Real-world example (micromagnetism)</h3>
        
<div class="image">
  <img src="./fosdem_files/fd.svg">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>Real-world example (micromagnetism)</h3>
        
  
  <p>
    Some implementations:
  </p>
  

  <ul>
  
    <li>OOMMF (script + GUI): ~100,000 lines C++, tcl </li>
  
    <li>Magnum (script only): ~ 30,000 lines CUDA, C++, Python </li>
  
    <li><b>MuMax3</b> (script + GUI): ~ 11,000 lines CUDA, Go</li>
  
  </ul>

<div class="image">
  <img src="./fosdem_files/vspace2.png">
</div>

<div class="image">
  <img src="./fosdem_files/vspace2.png">
</div>

<div class="image">
  <img src="./fosdem_files/banner.png">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>How suitable is Go for HPC?</h3>
        
  <ul>
  
    <li><b>Pure Go number crunching</b></li>
  
    <li>Go plus {C, C++, CUDA} number crunching</li>
  
    <li>Concurrency</li>
  
  </ul>

<div class="image">
  <img src="./fosdem_files/event.png">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>Go is</h3>
        
  <ul>
  
    <li>compiled</li>
  
    <li>statically typed</li>
  
    <li>supposedly fast</li>
  
  </ul>

  
  <p>
    <b>but also</b>
  </p>
  

  <ul>
  
    <li>garbage collected</li>
  
    <li>memory safe</li>
  
    <li>dynamic</li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h3>Hello, math!</h3>
        
  <div class="code playground" contenteditable="true" spellcheck="false">
<pre style="display: none"><span>package main

import (
	"fmt"
	"math"
	"math/big"
	"math/cmplx"
)

</span></pre>

<pre contenteditable="true" spellcheck="false"><span num="11">func main() {</span>
<span num="12">    fmt.Println("(1+1e-100)-1 =", (1+1e-100)-1)</span>
<span num="13">    fmt.Println("√-1          =", cmplx.Sqrt(-1))</span>
<span num="14">    fmt.Println("J₁(0.3)      =", math.J1(0.3))</span>
<span num="15">    fmt.Println("Bi(666, 333) =", big.NewInt(0).Binomial(666, 333))</span>
<span num="16">}</span>
</pre>


</div><div class="buttons"><button class="run">Run</button></div><div class="ui-resizable output" style="display: none;"><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div><div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div><pre></pre></div>

  
  <p>
    <b>Go math features:</b>
  </p>
  

  <ul>
  
    <li>precise compile-time constants</li>
  
    <li>complex numbers</li>
  
    <li>special functions</li>
  
    <li>big numbers.</li>
  
  </ul>

  
  <p>
    <b>But missing:</b>
  </p>
  

  <ul>
  
    <li>matrices</li>
  
    <li>matrix libraries (BLAS, FFT, ...)</li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h3>Performance</h3>
        
  
  <p>
    Example: dot product
  </p>
  

  
  <div class="code"><pre>func Dot(A, B []float64) float64{
    dot := 0.0
    for i  := range A{
        dot += A[i] * B[i]
    }
    return dot
}</pre></div>
  

      
      </article>
  
  
  
      <article>
      
        <h3>Performance</h3>
        
  <div class="code playground" contenteditable="true" spellcheck="false">
<pre style="display: none"><span>package main

import (
	"regexp"
	"testing"
	"github.com/barnex/cuda5/cu"
	"runtime"
	"fmt"
	"io/ioutil"
)

var tests = []testing.InternalTest{

}

var benchmarks = []testing.InternalBenchmark{

	{"BenchmarkDot", BenchmarkDot},

}

var examples = []testing.InternalExample{

}

var matchPat string
var matchRe *regexp.Regexp

func matchString(pat, str string) (result bool, err error) {
	if matchRe == nil || matchPat != pat {
		matchPat = pat
		matchRe, err = regexp.Compile(matchPat)
		if err != nil {
			return
		}
	}
	return matchRe.MatchString(str), nil
}



func main() {
	cu.Init(0)
	runtime.LockOSThread()
	testing.Main(matchString, tests, benchmarks, examples)
}

var DevNull = ioutil.Discard

</span></pre>

<pre><span num="51">func Dot(A, B []float64) float64{</span>
<span num="52">    dot := 0.0</span>
<span num="53">    for i  := range A{</span>
<span num="54">        dot += A[i] * B[i]</span>
<span num="55">    }</span>
<span num="56">    return dot</span>
<span num="57">}</span>
<span num="58"></span>
<span num="59">func BenchmarkDot(b *testing.B) {</span>
<span num="60">    A, B := make([]float64, 1024), make([]float64, 1024)</span>
<span num="61"></span>
<span num="62">    sum := 0.0</span>
<span num="63">    for i:=0; i&lt;b.N; i++{</span>
<span num="64">        sum += Dot(A, B)</span>
<span num="65">    }</span>
<span num="66">    fmt.Fprintln(DevNull, sum)  // use result</span>
<span num="67">}</span>
</pre>


</div><div class="buttons"><button class="run">Run</button></div><div class="ui-resizable output" style="display: none;"><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div><div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div><pre></pre></div>

  
  <div class="code"><pre>go test -bench .</pre></div>
  

  
  <p>
    times all BenchmarkXXX functions
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>Performance</h3>
        
  
  <p>
    Dot product example
  </p>
  

  
  <div class="code"><pre>Go (gc)               1 980 ns/op
Go (gcc -O3)          1 570 ns/op

C  (gcc -O3)          1 460 ns/op
C  (gcc -march=native)  760 ns/op

Python              200 180 ns/op</pre></div>
  

  <ul>
  
    <li>Typically, Go is ~10% slower than optimized, portable C</li>
  
    <li>But can be 2x - 3x slower than machine-tuned C</li>
  
  </ul>

<div class="image">
  <img src="./fosdem_files/vspace1.png">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>Profiling</h3>
        
  
  <p>
    Go has built-in profiling
  </p>
  

  
  <div class="code"><pre>go tool pprof</pre></div>
  

  
  <p>
    outputs your program's call graph with time spent per function
  </p>
  

<div class="image">
  <img src="./fosdem_files/pprof.svg">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>Pure Go number crunching</h3>
        
  
  <p>
    <b>On the up side</b>
  </p>
  

  <ul>
  
    <li>Good standard math library</li>
  
    <li>Built-in testing, benchmarking &amp; profiling</li>
  
    <li>Managed memory</li>
  
  </ul>

  
  <p>
    <b>On the down side</b>
  </p>
  

  <ul>
  
    <li>Still slower than machine-tuned C</li>
  
    <li>No matrix libraries etc.</li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h3>How suitable is Go for HPC?</h3>
        
  <ul>
  
    <li>Pure Go number crunching</li>
  
    <li><b>Go plus {C, C++, CUDA} number crunching</b></li>
  
    <li>Concurrency</li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h3>Hello, GPU!</h3>
        
  
  <p>
    Go can call C/C++ libs
  </p>
  

  <div class="code playground" contenteditable="true" spellcheck="false">
<pre style="display: none"><span>package main

import (
	"github.com/barnex/cuda5/cu"
	"runtime"
)


//#cgo CFLAGS: -I/usr/local/cuda/include/ 
//#cgo CFLAGS: -I/usr/local/cuda-5.0/include/ 
//#cgo LDFLAGS: -L/usr/lib/nvidia-319 
</span></pre>

<pre contenteditable="true" spellcheck="false"><span num="13">//#include &lt;cuda.h&gt;</span>
<span num="14">//#cgo LDFLAGS: -lcuda</span>
<span num="15">import "C"</span>
<span num="16">import "fmt"</span>
<span num="17"></span>
<span num="18">func main() {</span>
<span num="19">    buf := C.CString(string(make([]byte, 256)))</span>
<span num="20">    C.cuDeviceGetName(buf, 256, C.CUdevice(0))</span>
<span num="21">    fmt.Println("Hello, your GPU is:", C.GoString(buf))</span>
<span num="22">}</span>
</pre>

<pre style="display: none"><span>
func init(){
	runtime.LockOSThread()
	cu.Init(0)
}
</span></pre>
</div><div class="buttons"><button class="run">Run</button></div><div class="ui-resizable output" style="display: none;"><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div><div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div><pre></pre></div>

<div class="image">
  <img src="./fosdem_files/vspace2.png">
</div>

  
  <p>
    Building:
  </p>
  

  
  <div class="code"><pre>go build</pre></div>
  

  
  <p>
    All build information is in the source
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>Hello, GPU! (wrappers)</h3>
        
  <div class="code playground" contenteditable="true" spellcheck="false">
<pre style="display: none"><span>package main

import "runtime"

</span></pre>

<pre contenteditable="true" spellcheck="false"><span num="6">import(</span>
<span num="7">    "github.com/barnex/cuda5/cu"</span>
<span num="8">    "fmt"</span>
<span num="9">)</span>
<span num="10"></span>
<span num="11">func main(){</span>
<span num="12">    fmt.Println("Hello, your GPU is:", cu.Device(0).Name())</span>
<span num="13">}</span>
</pre>

<pre style="display: none"><span>
func init(){
	runtime.LockOSThread()
	cu.Init(0)
}
</span></pre>
</div><div class="buttons"><button class="run">Run</button></div><div class="ui-resizable output" style="display: none;"><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div><div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div><pre></pre></div>

<div class="image">
  <img src="./fosdem_files/vspace2.png">
</div>

  
  <p>
    Installing 3rd party code:
  </p>
  

  
  <div class="code"><pre>go get github.com/user/repo</pre></div>
  

  
  <p>
    (dependencies are compiled-in)
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>A note on memory (CPU)</h3>
        
  
  <p>
    Go is memory-safe, garbage collected.
<br>

    Your typical C library is not.
  </p>
  

  
  <p>
    Fortunately:
  </p>
  

  <ul>
  
    <li>Go is aware of C memory (no accidental garbage collection).</li>
  
    <li>Go properly aligns memory (needed by some HPC libraries)</li>
  
  </ul>

  
  <p>
    Allocate in Go, pass to C, let Go garbage collect
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>Go plus {C, C++, CUDA} number crunching</h3>
        
  
  <p>
    <b>On the downside</b>
  </p>
  

  <ul>
  
    <li>Have to write C wrappers</li>
  
  </ul>

  
  <p>
    <b>On the upside</b>
  </p>
  

  <ul>
  
    <li>You <i>can</i> call C</li>
  
    <li>Have Go manage your C memory</li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h3>How suitable is Go for HPC?</h3>
        
  <ul>
  
    <li>Pure Go number crunching</li>
  
    <li>Go plus {C, C++, CUDA} number crunching</li>
  
    <li><b>Concurrency</b></li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h3>Real-world concurrency (MuMax3)</h3>
        
  
  <p>
    There's more to HPC then number crunching and memory management
  </p>
  

  <ul>
  
    <li>I/O</li>
  
    <li>Interactive supercomputing</li>
  
    <li>...</li>
  
  </ul>

<div class="image">
  <img src="./fosdem_files/gui.png">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>Real-world concurrency (MuMax3)</h3>
        
  
  <p>
    Output: GPU does not wait for hard disk
  </p>
  

<div class="image">
  <img src="./fosdem_files/design1.svg">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>Real-world concurrency (MuMax3)</h3>
        
  
  <p>
    Go <b>channels</b> are like type-safe UNIX pipes between threads.
  </p>
  

  <div class="code playground" contenteditable="true" spellcheck="false">
<pre style="display: none"><span>package main


func save([]float64){ }

var data = []float64{1, 2, 3}

</span></pre>

<pre contenteditable="true" spellcheck="false"><span num="9">var pipe = make(chan []float64, BUFSIZE)</span>
<span num="10"></span>
<span num="11">func runIO(){</span>
<span num="12">    for{</span>
<span num="13">        data := &lt;- pipe</span>
<span num="14">        save(data)</span>
<span num="15">    }</span>
<span num="16">}</span>
<span num="17"></span>
<span num="18">func main() {</span>
<span num="19">    go runIO() // returns immediately</span>
<span num="20">    pipe &lt;- data // returns immediately</span>
<span num="21">}</span>
</pre>


</div><div class="buttons"><button class="run">Run</button></div><div class="ui-resizable output" style="display: none;"><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div><div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div><pre></pre></div>

  
  <p>
    Real example: 60 lines Go, ~2x I/O speed-up
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>Real-world concurrency (MuMax3)</h3>
        
  
  <p>
    GUI: change parameters while running,
<br>

    without race conditions
  </p>
  

<div class="image">
  <img src="./fosdem_files/design.svg">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>Real-world concurrency (MuMax3)</h3>
        
  
  <p>
    You can send function <b>closures</b> over channels.
  </p>
  

  <div class="code playground" contenteditable="true" spellcheck="false">
<pre style="display: none"><span>package main


func timestep(){ }


</span></pre>

<pre contenteditable="true" spellcheck="false"><span num="8">var pipe = make(chan func()) // channel of functions</span>
<span num="9"></span>
<span num="10">func main() {</span>
<span num="11">    for {</span>
<span num="12">        select{</span>
<span num="13">            case f := &lt;- pipe:</span>
<span num="14">                f()</span>
<span num="15">            default: doCalculation()</span>
<span num="16">        }</span>
<span num="17">    }</span>
<span num="18">}</span>
</pre>


</div><div class="buttons"><button class="run">Run</button></div><div class="ui-resizable output" style="display: none;"><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div><div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div><pre></pre></div>

  
  <p>
    Concurrent modification without mutex locking/unlocking.
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>And we can prove it's thread-safe</h3>
        
  
  <p>
    Go has built-in testing for race conditions
  </p>
  

  
  <div class="code"><pre>go build -race</pre></div>
  

  
  <p>
    enables race testing. Output if things go wrong:
  </p>
  

  
  <div class="code"><pre>==================
WARNING: DATA RACE
Write by goroutine 3:
  main.func·001()
      /home/billgates/buggycode/race.go:10 +0x38

Previous read by main goroutine:
  main.main()
      /home/billgates/buggycode/race.go:21 +0x9c

Goroutine 3 (running) created at:
  main.main()
      /home/billgates/buggycode/race.go:12 +0x33
==================</pre></div>
  

      
      </article>
  
  
  
      <article>
      
        <h3>Go concurrency</h3>
        
  
  <p>
    <b>On the up side</b>
  </p>
  

  <ul>
  
    <li>Easy, safe, built-in concurrency</li>
  
  </ul>

  
  <p>
    <b>On the down side</b>
  </p>
  

  <ul>
  
    <li>There is no downside</li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h2>Demonstration</h2>
      
      </article>
  
  
  
      <article>
      
        <h3>Demonstration</h3>
        
<div class="image">
  <img src="./fosdem_files/gui4.png">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>Demonstration</h3>
        
<div class="image">
  <img src="./fosdem_files/gui3.png">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>Demonstration</h3>
        
<div class="image">
  <img src="./fosdem_files/gui.png">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>Demonstration</h3>
        
<div class="image">
  <img src="./fosdem_files/hd.gif">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>A note on memory (GPU)</h3>
        
  
  <p>
    GPU memory still needs to be managed manually.
<br>

    But a <b>GPU memory pool</b> is trivial to implement in Go.
  </p>
  

  <div class="code playground" contenteditable="true" spellcheck="false">
<pre style="display: none"><span>package main

import(
	"runtime"
)

import "github.com/barnex/cuda5/cu"

const BUFSIZE = 100

</span></pre>

<pre><span num="12">var pool = make(chan cu.DevicePtr, 16)</span>
<span num="13"></span>
<span num="14">func initPool(){</span>
<span num="15">    for i:=0; i&lt;16; i++{</span>
<span num="16">        pool &lt;- cu.MemAlloc(BUFSIZE)</span>
<span num="17">    }</span>
<span num="18">}</span>
<span num="19"></span>
<span num="20">func recycle(buf cu.DevicePtr){</span>
<span num="21">    pool &lt;- buf</span>
<span num="22">}</span>
<span num="23"></span>
<span num="24">func main(){</span>
<span num="25">    initPool()</span>
<span num="26"></span>
<span num="27">    GPU_data := &lt;- pool</span>
<span num="28">    defer recycle(GPU_data)</span>
<span num="29">    // ...</span>
<span num="30">}</span>
</pre>

<pre style="display: none"><span>
func init(){
	runtime.LockOSThread()
	cu.Init(0)
	dev := cu.Device(0)
	cu.CtxCreate(cu.CTX_SCHED_YIELD, dev).SetCurrent()
}
</span></pre>
</div><div class="buttons"><button class="run">Run</button></div><div class="ui-resizable output" style="display: none;"><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div><div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div><pre></pre></div>

      
      </article>
  
  
  
      <article>
      
        <h3>Calling CUDA kernels (the C way)</h3>
        
  
  <p>
    <b>GPU</b> (code for one element)
  </p>
  

  
  <div class="code"><pre>__global__ void add(float *a, float *b, float *c, N) {
    int i = blockIdx.x * blockDim.x + threadIdx.x;
    if (i &lt; N) 
       c[i] = a[i] + b[i];    
}</pre></div>
  

  
  <p>
    <b>CPU</b> wrapper (divide and launch)
  </p>
  

  
  <div class="code"><pre>void gpu_add(float *a, float *b, float *c, int N){
    dim3 block = ...
    add&lt;&lt;&lt;N/BLOCK, BLOCK&gt;&gt;&gt;(a, b, c);
}</pre></div>
  

  
  <p>
    <b>Go</b> wrapper wrapper
  </p>
  

  
  <div class="code"><pre>func Add(a, b, c []float32){
    C.gpu_add(unsafe.Pointer(&amp;a[0]), unsafe.Pointer(&amp;b[0]),
              unsafe.Pointer(&amp;c[0]), C.int(len(a)))
}</pre></div>
  

      
      </article>
  
  
  
      <article>
      
        <h3>Calling CUDA kernels (cuda2go)</h3>
        
  <ul>
  
    <li>CUDA kernel to Go wrapper (calling <b>nvcc</b> once).</li>
  
    <li>Further deployment without <b>nvcc</b> or <b>CUDA</b> libs.</li>
  
  </ul>

  
  <p>
    Others to fetch your CUDA project the usual way:
  </p>
  

  
  <div class="code"><pre>go get github.com/user/my-go-cuda-project</pre></div>
  

<div class="image">
  <img src="./fosdem_files/vspace2.png">
</div>

  
  <div class="code"><pre>// THIS FILE IS GENERATED BY CUDA2GO, EDITING IS FUTILE
func Add(a, b, c unsafe.Pointer, N int, cfg *config) {
    args := add_args_t{a, b, c, N}
    cu.LaunchKernel(add_code, cfg.Grid.X, cfg.Grid.Y, cfg.Grid.Z, cfg.Block.X, cfg.Block.Y, cfg.Block.Z, 0, stream0, argptrs[:])
}

// PTX assembly
const add_ptx_20 = `
.version 3.1
.target sm_20
.address_size 64

.visible .entry add(
    .param .u64 madd2_param_0,
    .param .u64 madd2_param_1,
    .param .f32 madd2_param_2,
    .param .u64 madd2_param_3,
    .param .f32 madd2_param_4,
    .param .u32 madd2_param_5
)
{
    .reg .pred     %p&lt;2&gt;;
    .reg .s32     %r&lt;12&gt;;
    .reg .f32     %f&lt;7&gt;;
    .reg .s64     %rd&lt;11&gt;;</pre></div>
  

      
      </article>
  
  
  
      <article>
      
        <h3>Vector add example</h3>
        
  
  <p>
    Adding two vectors on GPU (example from nvidia)
  </p>
  

  <div class="code playground" contenteditable="true" spellcheck="false">


<pre><span num="1">#include "../common/book.h"</span>
<span num="2">#define N 10</span>
<span num="3"></span>
<span num="4">int main( void ) {</span>
<span num="5">    int a[N], b[N], c[N];</span>
<span num="6">    int *dev_a, *dev_b, *dev_c;</span>
<span num="7">    // allocate the memory on the GPU</span>
<span num="8">    HANDLE_ERROR( cudaMalloc( (void**)&amp;dev_a, N * sizeof(int) ) );</span>
<span num="9">    HANDLE_ERROR( cudaMalloc( (void**)&amp;dev_b, N * sizeof(int) ) );</span>
<span num="10">    HANDLE_ERROR( cudaMalloc( (void**)&amp;dev_c, N * sizeof(int) ) );</span>
<span num="11"></span>
<span num="12">    // fill the arrays 'a' and 'b' on the CPU</span>
<span num="13">    for (int i=0; i&lt;N; i++) {</span>
<span num="14">        a[i] = -i;</span>
<span num="15">        b[i] = i * i;</span>
<span num="16">    }</span>
<span num="17">    // copy the arrays 'a' and 'b' to the GPU</span>
<span num="18">    HANDLE_ERROR( cudaMemcpy( dev_a, a, N * sizeof(int), cudaMemcpyHostToDevice ) );</span>
<span num="19">    HANDLE_ERROR( cudaMemcpy( dev_b, b, N * sizeof(int), cudaMemcpyHostToDevice ) );</span>
<span num="20">    add&lt;&lt;&lt;N,1&gt;&gt;&gt;( dev_a, dev_b, dev_c ); // copy the array 'c' back from the GPU to the CPU</span>
<span num="21">    HANDLE_ERROR( cudaMemcpy( c, dev_c, N * sizeof(int), cudaMemcpyDeviceToHost ) );</span>
<span num="22">    // display the results</span>
<span num="23">    for (int i=0; i&lt;N; i++) {</span>
<span num="24">        printf( "%d + %d = %d\n", a[i], b[i], c[i] );</span>
<span num="25">    }</span>
<span num="26">    // free the memory allocated on the GPU</span>
<span num="27">    cudaFree( dev_a );</span>
<span num="28">    cudaFree( dev_b );</span>
<span num="29">    cudaFree( dev_c );</span>
<span num="30">    return 0;</span>
<span num="31">}</span>
</pre>


</div><div class="buttons"><button class="run">Run</button></div><div class="ui-resizable output" style="display: none;"><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div><div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div><pre></pre></div>

      
      </article>
  
  
  
      <article>
      
        <h3>Vector add example</h3>
        
  
  <p>
    Adding two vectors on GPU (Go)
  </p>
  

  
  <div class="code"><pre>package main

import "github.com/mumax/3/cuda"

func main(){

    N := 3
    a := cuda.NewSlice(N)
    b := cuda.NewSlice(N)
    c := cuda.NewSlice(N)
    defer a.Free()
    defer b.Free()
    defer c.Free()

    a.CopyHtoD([]float32{0, -1, -2})
    b.CopyHtoD([]float32{0,  1,  4})

    cfg := Make1DConfig(N)
    add_kernel(a.Ptr(), b.Ptr(), c.Ptr(), cfg)
    
    fmt.Println("result:", a.HostCopy())
}</pre></div>
  

      
      </article>
  
  

      <article>
        <h3>Thank you</h3>
        
          <div class="presenter">
            
  
  <p>
    Arne Vansteenkiste
  </p>
  

  
  <p>
    Ghent University
  </p>
  
<p class="link"><a href="mailto:Arne.Vansteenkiste@Ugent.be" target="_blank">Arne.Vansteenkiste@Ugent.be</a></p><p class="link"><a href="http://mumax.github.io/" target="_blank">http://mumax.github.io</a></p>
          </div>
        
          <div class="presenter">
            
  
  <p>
    
  </p>
  

          </div>
        
      </article>

  
  
  <script src="./fosdem_files/play.js"></script>
  

<div class="slide-area" id="prev-slide-area"></div><div class="slide-area" id="next-slide-area"></div></section><link rel="stylesheet" type="text/css" href="./fosdem_files/css"><link rel="stylesheet" type="text/css" href="./fosdem_files/styles.css"><link rel="stylesheet" type="text/css" media="print" href="./fosdem_files/print.css"></body></html>